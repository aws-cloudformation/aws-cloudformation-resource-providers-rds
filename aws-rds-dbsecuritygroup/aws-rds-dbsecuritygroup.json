{
  "typeName": "AWS::RDS::DBSecurityGroup",
  "description": "The AWS::RDS::DBSecurityGroup resource creates or updates an Amazon RDS DB security group.",
  "sourceUrl": "https://github.com/aws-cloudformation/aws-cloudformation-rpdk.git",
  "definitions": {
    "Tag": {
      "description": "A key-value pair to associate with a resource.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Key": {
          "type": "string",
          "description": "The key name of the tag. You can specify a value that is 1 to 127 Unicode characters in length and cannot be prefixed with aws:. You can use any of the following characters: the set of Unicode letters, digits, whitespace, _, ., /, =, +, and -. ",
          "minLength": 1,
          "maxLength": 127
        },
        "Value": {
          "type": "string",
          "description": "The value for the tag. You can specify a value that is 1 to 255 Unicode characters in length and cannot be prefixed with aws:. You can use any of the following characters: the set of Unicode letters, digits, whitespace, _, ., /, =, +, and -. ",
          "minLength": 1,
          "maxLength": 255
        }
      },
      "required": [
        "Key",
        "Value"
      ]
    },
    "Ingress": {
      "type": "object",
      "description": "The Ingress property type specifies an individual ingress rule within an AWS::RDS::DBSecurityGroup resource.",
      "properties": {
        "CIDRIP": {
          "type": "string",
          "description": "The IP range to authorize."
        },
        "EC2SecurityGroupId": {
          "type": "string",
          "description": "Id of the EC2 Security Group to authorize. For VPC DB Security Groups, EC2SecurityGroupId must be provided. Otherwise, EC2SecurityGroupOwnerId and either EC2SecurityGroupName or EC2SecurityGroupId must be provided."
        },
        "EC2SecurityGroupName": {
          "type": "string",
          "description": "Name of the EC2 Security Group to authorize. For VPC DB Security Groups, EC2SecurityGroupId must be provided. Otherwise, EC2SecurityGroupOwnerId and either EC2SecurityGroupName or EC2SecurityGroupId must be provided."
        },
        "EC2SecurityGroupOwnerId": {
          "type": "string",
          "description": "AWS Account Number of the owner of the EC2 Security Group specified in the EC2SecurityGroupName parameter. The AWS Access Key ID is not an acceptable value. For VPC DB Security Groups, EC2SecurityGroupId must be provided. Otherwise, EC2SecurityGroupOwnerId and either EC2SecurityGroupName or EC2SecurityGroupId must be provided."
        }
      },
      "additionalProperties": false,
      "oneOf": [
        {
          "required": [
            "EC2SecurityGroupId"
          ]
        },
        {
          "allOf": [
            {
              "required": [
                "EC2SecurityGroupOwnerId"
              ]
            },
            {
              "anyOf": [
                {
                  "required": [
                    "EC2SecurityGroupName"
                  ]
                },
                {
                  "required": [
                    "EC2SecurityGroupId"
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  },
  "properties": {
    "GroupName": {
      "type": "string",
      "description": "Specifies the name of the DB security group.",
      "pattern": "^[a-zA-Z]{1}(?:-?[a-zA-Z0-9]){0,254}$"
    },
    "GroupDescription": {
      "type": "string",
      "description": "Provides the description of the DB Security Group."
    },
    "EC2VpcId": {
      "type": "string",
      "description": "The identifier of an Amazon VPC. This property indicates the VPC that this DB security group belongs to."
    },
    "DBSecurityGroupIngress": {
      "type": "array",
      "uniqueItems": true,
      "description": "Ingress rules to be applied to the DB security group.",
      "items": {
        "$ref": "#/definitions/Ingress"
      }
    },
    "Tags": {
      "type": "array",
      "description": "Tags to assign to the DB security group.",
      "items": {
        "$ref": "#/definitions/Tag"
      }
    }
  },
  "additionalProperties": false,
  "required": [
    "DBSecurityGroupIngress",
    "GroupDescription"
  ],
  "createOnlyProperties": [
    "/properties/GroupName",
    "/properties/EC2VpcId",
    "/properties/GroupDescription"
  ],
  "primaryIdentifier": [
    "/properties/GroupName"
  ],
  "handlers": {
    "create": {
      "permissions": [
        "rds:AddTagsToResource",
        "rds:AuthorizeDBSecurityGroupIngress",
        "rds:CreateDBSecurityGroup",
        "rds:DescribeDBSecurityGroups",
        "rds:ListTagsForResource"
      ]
    },
    "read": {
      "permissions": [
        "rds:DescribeDBSecurityGroups",
        "rds:ListTagsForResource"
      ]
    },
    "update": {
      "permissions": [
        "rds:AddTagsToResource",
        "rds:AuthorizeDBSecurityGroupIngress",
        "rds:DescribeDBSecurityGroups",
        "rds:ListTagsForResource",
        "rds:ModifyDBSecurityGroup",
        "rds:RemoveTagsFromResource",
        "rds:RevokeDBSecurityGroupIngress"
      ]
    },
    "delete": {
      "permissions": [
        "rds:DeleteDBSecurityGroup",
        "rds:DescribeDBSecurityGroups"
      ]
    },
    "list": {
      "permissions": [
        "rds:DescribeDBSecurityGroups"
      ]
    }
  }
}
